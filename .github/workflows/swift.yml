name: Build iOS App (Simulator Only)

on:
  push:
    branches:
      - main

jobs:
  build-ios:
    name: Build for iOS Simulator (No Code Signing)
    runs-on: macos-latest

    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4

      - name: üõ†Ô∏è Select Xcode Version
        run: sudo xcode-select -switch /Applications/Xcode.app

      - name: üì¶ Install CocoaPods (if Podfile exists)
        run: |
          if [ -f "Podfile" ]; then
            sudo gem install cocoapods
            pod install
          else
            echo "No Podfile found, skipping pod install."
          fi

      - name: üß± Build App for iOS Simulator
        run: |
          DERIVED_DATA=build_data
          xcodebuild \
            -project YourApp.xcodeproj \  # Replace if using .xcworkspace
            -scheme YourApp \             # Replace with your scheme name
            -sdk iphonesimulator \
            -configuration Debug \
            -destination 'platform=iOS Simulator,name=iPhone 14' \
            CODE_SIGNING_ALLOWED=NO \
            CODE_SIGN_IDENTITY="" \
            CODE_SIGNING_REQUIRED=NO \
            -derivedDataPath $DERIVED_DATA \
            clean build

      - name: üì§ Export .app to Output Directory
        run: |
          mkdir -p output
          APP_PATH=$(find build_data/Build/Products/Debug-iphonesimulator -name "*.app" -type d | head -n 1)
          cp -R "$APP_PATH" output/

      - name: üì¶ Upload .app Artifact
        uses: actions/upload-artifact@v4
        with:
          name: iOS-Simulator-Build
          path: output/*.app
